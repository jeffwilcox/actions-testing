name: Build the site
on: [workflow_dispatch]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: azure/docker-login@v1
        with:
          login-server: 'docker.pkg.github.com'
          username: 'jeffwilcox'
          password: ${{ secrets.GP_PASSWORD }}
      - name: runit
        run: |
          docker run -i -v ${PWD}:/usr/local/site docker.pkg.github.com/microsoft/opensource.microsoft.com/custom-jekyll-builder:latest sh << COMMANDS
          cd /usr/local/site
          echo Jekyll goods...
          bundle install
          bundle outdated
          # echo JavaScript ecosystem...
          # npm i
          echo Gulp...
          ./node_modules/gulp/bin/gulp.js build
          echo Building static site...
          JEKYLL_ENV=opensource.microsoft.com jekyll build
          COMMANDS
